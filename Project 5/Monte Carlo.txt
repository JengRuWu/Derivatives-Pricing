Sub Button2_Click()Dim St, K, rr, q, sigma, Tt, M, n, Savet, t, sim, rep, u, dSt = Cells(1, 2)K = Cells(2, 2)rr = Cells(3, 2)q = Cells(4, 2)sigma = Cells(5, 2)Tt = Cells(6, 2)M = Cells(7, 2)n = Cells(8, 2)Savet = Cells(9, 2)t = Cells(10, 2)sim = Cells(11, 2)rep = Cells(12, 2)n_t = n * t / TtDim repeat()ReDim repeat(1 To rep)For g = 1 To rep    Dim Z()    ReDim Z(1 To sim, 1 To n)    For i = 1 To sim        For j = 1 To n            Random = Rnd()            If Random = 0 Or Random = 1 Then                j = j - 1            Else                Z(i, j) = WorksheetFunction.NormSInv(Random)            End If        Next j    Next i        Dim payoff()    ReDim payoff(1 To sim)        For i = 1 To sim        Dim temp()        ReDim temp(0 To n)        temp(0) = Savet * (n_t + 1)                Z(i, 1) = Z(i, 1) * sigma * Sqr(Tt / n) + Log(St) + (rr - q - sigma * sigma * 0.5) * Tt / n        temp(1) = Exp(Z(i, 1))                For j = 2 To n            Z(i, j) = Z(i, j) * sigma * Sqr(Tt / n) + Z(i, j - 1) + (rr - q - sigma * sigma * 0.5) * Tt / n            temp(j) = Exp(Z(i, j))        Next j        Average = WorksheetFunction.Sum(temp())        Average = Average / (n + n_t + 1)        payoff(i) = WorksheetFunction.Max(Average - K, 0)    Next i    repeat(g) = WorksheetFunction.Average(payoff()) * Exp(-rr * Tt)Next gDim mean, Sdmean = WorksheetFunction.Average(repeat)Sd = WorksheetFunction.StDev(repeat)Cells(9, 7) = "Mean"Cells(9, 8) = meanCells(10, 7) = "SD"Cells(10, 8) = SdCells(11, 7) = "Upper Bound"Cells(11, 8) = mean + 2 * SdCells(12, 7) = "Lower Bound"Cells(12, 8) = mean - 2 * Sd    End Sub