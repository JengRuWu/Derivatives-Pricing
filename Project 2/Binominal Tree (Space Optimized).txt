Sub Button4_Click()'_____q≈‹º∆Dim S0, K, r, q, sigma, T, n, u, dS0 = Cells(1, 2)K = Cells(2, 2)r = Cells(3, 2)q = Cells(4, 2)sigma = Cells(5, 2)T = Cells(6, 2)n = Cells(9, 2)u = Exp(sigma * Sqr(T / n))d = 1 / u'__¶°Dim EC(), EP()ReDim EC(n), EP(n)For j = 0 To n    EC(j) = WorksheetFunction.Max(S0 * u ^ (n - j) * d ^ j - K, 0)    EP(j) = WorksheetFunction.Max(K - S0 * u ^ (n - j) * d ^ j, 0)Next jDim pp = (Exp((r - q) * T / n) - d) / (u - d)For i = n - 1 To 0 Step -1    For j = 0 To i        EC(j) = Exp(-r * T / n) * (p * EC(j) + (1 - p) * EC(j + 1))        EP(j) = Exp(-r * T / n) * (p * EP(j) + (1 - p) * EP(j + 1))    Next jNext iCells(18, 6) = "European Call"Cells(18, 7) = EC(0)Cells(19, 6) = "European Put"Cells(19, 7) = EP(0)'__¶°Dim AC(), AP()ReDim AC(n), AP(n)For j = 0 To n    AC(j) = WorksheetFunction.Max(S0 * u ^ (n - j) * d ^ j - K, 0)    AP(j) = WorksheetFunction.Max(K - S0 * u ^ (n - j) * d ^ j, 0)Next jFor i = n - 1 To 0 Step -1    For j = 0 To i        AC(j) = WorksheetFunction.Max(Exp(-r * T / n) * (p * AC(j) + (1 - p) * AC(j + 1)), S0 * u ^ (i - j) * d ^ j - K)        AP(j) = WorksheetFunction.Max(Exp(-r * T / n) * (p * AP(j) + (1 - p) * AP(j + 1)), K - S0 * u ^ (i - j) * d ^ j)    Next jNext iCells(20, 6) = "American Call"Cells(20, 7) = AC(0)Cells(21, 6) = "American Put"Cells(21, 7) = AP(0)End Sub