Sub Button3_Click()Dim S0, K, r, q, sigma, T, n, u, dS0 = Cells(1, 2)K = Cells(2, 2)r = Cells(3, 2)q = Cells(4, 2)sigma = Cells(5, 2)T = Cells(6, 2)n = Cells(9, 2)u = Exp(sigma * Sqr(T / n))d = 1 / uDim S()ReDim S(n, n)For i = 0 To n    For j = 0 To i        S(i, j) = S0 * (u ^ (i - j)) * (d ^ j)    Next jNext iDim EC(), EP()ReDim EC(n, n), EP(n, n)For i = 0 To n    EC(n, i) = WorksheetFunction.Max(0, S(n, i) - K)    EP(n, i) = WorksheetFunction.Max(0, K - S(n, i))Next iDim pp = (Exp((r - q) * T / n) - d) / (u - d)For i = n - 1 To 0 Step -1    For j = 0 To i        EC(i, j) = Exp(-r * T / n) * (p * EC(i + 1, j) + (1 - p) * EC(i + 1, j + 1))        EP(i, j) = Exp(-r * T / n) * (p * EP(i + 1, j) + (1 - p) * EP(i + 1, j + 1))    Next jNext iCells(13, 6) = "European Call"Cells(13, 7) = EC(0, 0)Cells(14, 6) = "European Put"Cells(14, 7) = EP(0, 0)Dim AC(), AP()ReDim AC(n, n), AP(n, n)For i = 0 To n    AC(n, i) = WorksheetFunction.Max(0, S(n, i) - K)    AP(n, i) = WorksheetFunction.Max(0, K - S(n, i))Next iFor i = n - 1 To 0 Step -1    For j = 0 To i        AC(i, j) = WorksheetFunction.Max(Exp(-r * T / n) * (p * AC(i + 1, j) + (1 - p) * AC(i + 1, j + 1)), S(i, j) - K)        AP(i, j) = WorksheetFunction.Max(Exp(-r * T / n) * (p * AP(i + 1, j) + (1 - p) * AP(i + 1, j + 1)), K - S(i, j))    Next jNext iCells(15, 6) = "American Call"Cells(15, 7) = AC(0, 0)Cells(16, 6) = "American Put"Cells(16, 7) = AP(0, 0)End Sub