Sub Button6_Click()Dim S0, K, r, q, sigma, T, nS0 = Cells(1, 2)K = Cells(2, 2)r = Cells(3, 2)q = Cells(4, 2)sigma = Cells(5, 2)T = Cells(6, 2)n = Cells(9, 2)Dim u, d, pu = Exp(sigma * Sqr(T / n))d = 1 / up = (Exp((r - q) * T / n) - d) / (u - d)Dim EC, EPEC = 0EP = 0For j = 0 To n    '__log(Cn_j)____log (n! / j! (n-j)!)(n-j)!)    If j = 0 Then        b = 0    Else        b = Log(1)        For i = n To n - j + 1 Step -1            If j = 0 Then                b = Log(1)            Else                b = b + Log(i / (n + 1 - i))            End If        Next i    End If    '__Log(Cn_j*p^(n-j)*(1-p)^j)^j)    b = b + (n - j) * Log(p) + j * Log(1 - p)    EC = EC + Exp(b) * WorksheetFunction.Max(S0 * u ^ (n - j) * d ^ j - K, 0)    EP = EP + Exp(b) * WorksheetFunction.Max(K - S0 * u ^ (n - j) * d ^ j, 0)Next jEC = EC * Exp(-r * T)EP = EP * Exp(-r * T)Cells(23, 6) = "European Call"Cells(23, 7) = ECCells(24, 6) = "European Put"Cells(24, 7) = EPEnd Sub