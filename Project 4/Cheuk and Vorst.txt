Sub Button4_Click()Dim St, rr, q, sigma, littleT, bigT, Smaxt, T, nSt = Cells(1, 2)rr = Cells(2, 2)q = Cells(3, 2)sigma = Cells(4, 2)littleT = Cells(5, 2)bigT = Cells(6, 2)T = bigT - littleTn = Cells(8, 2)Dim u, d, miu, pu = Exp(sigma * Sqr(T / n))d = 1 / umiu = Exp((rr - q) * T / n)p = (miu * u - 1) / (miu * (u - d))Dim SU(), putprice_E(), putprice_A()ReDim SU(n, n), putprice_E(n, n), putprice_A(n, n)'_UUFor i = 0 To n    For j = 0 To i        SU(i, j) = i - j    Next jNext i'_____payoffayoffFor j = 0 To n    putprice_E(n, j) = WorksheetFunction.Max(u ^ SU(n, j) - 1, 0)    putprice_A(n, j) = WorksheetFunction.Max(u ^ SU(n, j) - 1, 0)Next j'backward inductionFor i = n - 1 To 0 Step -1    For j = 0 To i        If j <> i Then            putprice_E(i, j) = (1 - p) * putprice_E(i + 1, j) + p * putprice_E(i + 1, j + 2)            putprice_E(i, j) = putprice_E(i, j) * Exp(-rr * T / n) * miu            putprice_A(i, j) = (1 - p) * putprice_A(i + 1, j) + p * putprice_A(i + 1, j + 2)            putprice_A(i, j) = putprice_A(i, j) * Exp(-rr * T / n) * miu        Else            putprice_E(i, j) = (1 - p) * putprice_E(i + 1, j) + p * putprice_E(i + 1, i + 1)            putprice_E(i, j) = putprice_E(i, j) * Exp(-rr * T / n) * miu            putprice_A(i, j) = (1 - p) * putprice_A(i + 1, j) + p * putprice_A(i + 1, i + 1)            putprice_A(i, j) = putprice_A(i, j) * Exp(-rr * T / n) * miu        End If        Dim payoff        payoff = WorksheetFunction.Max(u ^ SU(i, j) - 1, 0)        If putprice_A(i, j) < payoff Then            putprice_A(i, j) = payoff        End If    Next jNext iputprice_E(0, 0) = putprice_E(0, 0) * Stputprice_A(0, 0) = putprice_A(0, 0) * StCells(22, 7) = "European Put"Cells(22, 8) = putprice_E(0, 0)Cells(23, 7) = "American Put"Cells(23, 8) = putprice_A(0, 0)End Sub