Sub Button3_Click()Dim St, rr, q, sigma, littleT, bigT, Smaxt, T, nSt = Cells(1, 2)rr = Cells(2, 2)q = Cells(3, 2)sigma = Cells(4, 2)littleT = Cells(5, 2)bigT = Cells(6, 2)T = bigT - littleTSmaxt = Cells(7, 2)n = Cells(8, 2)Dim S()Dim Smax()Dim putprice_E()Dim putprice_A()Dim no_smax()ReDim S(n, n)ReDim Smax(n, n, 2 * n + 1)ReDim putprice_E(n, n, 2 * n + 1)ReDim putprice_A(n, n, 2 * n + 1)ReDim no_smax(n, n)Dim u, d, pu = Exp(sigma * Sqr(T / n))d = 1 / up = (Exp((rr - q) * T / n) - d) / (u - d)'_____˘™∫æFor i = 0 To n    For j = 0 To i        S(i, j) = St * (u ^ (i - j)) * (d ^ j)    Next jNext i'____™—ª˘If n Mod 2 = 0 Then    S(n, n / 2) = StEnd IfFor i = n - 2 To 1 Step -1    For j = 0 To i        S(i, j) = S(i + 2, j + 1)    Next jNext iSmax(0, 0, 1) = Smaxtno_smax(0, 0) = 1'SmaxFor i = 1 To n    For j = 0 To i        If j / i <= 1 / 2 Then            no_smax(i, j) = j + 1            For w = 0 To j                If S(i - j + w, w) <= Smaxt Then                    Dim Test_1 As Boolean                        Test_1 = False                    For m = 1 To no_smax(i, j)                        If Smax(i, j, m) = Smaxt Then                            Test_1 = True                        End If                    Next m                    If Test_1 = True Then                        no_smax(i, j) = no_smax(i, j) - 1                   Else                        Smax(i, j, w + 1) = Smaxt                    End If                Else                    Smax(i, j, w + 1) = S(i - j + w, w)                End If            Next w        Else            no_smax(i, j) = i - j + 1            For w = 0 To i - j               If S(i - j + w, w) <= Smaxt Then                    Dim Test_2 As Boolean                        Test_2 = False                    For m = 1 To no_smax(i, j)                        If Smax(i, j, m) = Smaxt Then                            Test_2 = True                        End If                    Next m                    If Test_2 = True Then                        no_smax(i, j) = no_smax(i, j) - 1                   Else                        Smax(i, j, w + 1) = Smaxt                    End If                Else                    Smax(i, j, w + 1) = S(i - j + w, w)                End If            Next w        End If    Next jNext iFor j = 0 To n    For m = 1 To no_smax(n, j)        putprice_E(n, j, m) = Smax(n, j, m) - S(n, j)        putprice_A(n, j, m) = Smax(n, j, m) - S(n, j)    Next mNext jFor i = n - 1 To 0 Step -1    For j = 0 To i        For m = 1 To no_smax(i, j)            Dim temp As Boolean            temp = False            For w = 1 To no_smax(i + 1, j)                If Smax(i + 1, j, w) = Smax(i, j, m) Then                    putprice_E(i, j, m) = p * putprice_E(i + 1, j, w)                    putprice_A(i, j, m) = p * putprice_A(i + 1, j, w)                    temp = True                End If            Next w                        If temp = False Then                For w = 1 To no_smax(i + 1, j)                     If Smax(i + 1, j, w) = S(i + 1, j) Then                        putprice_E(i, j, m) = p * putprice_E(i + 1, j, w)                        putprice_A(i, j, m) = p * putprice_A(i + 1, j, w)                    End If                Next w            End If                         For w = 1 To no_smax(i + 1, j + 1)                If Smax(i + 1, j + 1, w) = Smax(i, j, m) Then                    putprice_E(i, j, m) = putprice_E(i, j, m) + (1 - p) * putprice_E(i + 1, j + 1, w)                    putprice_A(i, j, m) = putprice_A(i, j, m) + (1 - p) * putprice_A(i + 1, j + 1, w)                End If            Next w            putprice_E(i, j, m) = putprice_E(i, j, m) * Exp(-rr * (T / n))            putprice_A(i, j, m) = putprice_A(i, j, m) * Exp(-rr * (T / n))            If putprice_A(i, j, m) < Smax(i, j, m) - S(i, j) Then                putprice_A(i, j, m) = Smax(i, j, m) - S(i, j)            End If        Next m    Next jNext iCells(16, 7) = "European Put"Cells(16, 8) = putprice_E(0, 0, 1)Cells(17, 7) = "American Put"Cells(17, 8) = putprice_A(0, 0, 1)End Sub