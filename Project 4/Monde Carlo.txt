Sub Button1_Click()Dim St, rr, q, sigma, littleT, bigT, Smaxt, T, n, sim, rep, deltaTSt = Cells(1, 2)rr = Cells(2, 2)q = Cells(3, 2)sigma = Cells(4, 2)littleT = Cells(5, 2)bigT = Cells(6, 2)T = bigT - littleTSmaxt = Cells(7, 2)n = Cells(8, 2)sim = Cells(9, 2)rep = Cells(10, 2)Dim repeat()ReDim repeat(1 To rep)For g = 1 To rep    Dim Z()    ReDim Z(1 To sim, 1 To n)    For i = 1 To sim        For j = 1 To n            Random = Rnd()            If Random = 0 Or Random = 1 Then                j = j - 1            Else                Z(i, j) = WorksheetFunction.NormSInv(Random)            End If        Next j    Next i        Dim payoff()    ReDim payoff(1 To sim)        For i = 1 To sim        Dim temp()        ReDim temp(0 To n)        temp(0) = Smaxt        Z(i, 1) = Z(i, 1) * sigma * Sqr(T / n) + Log(St) + (rr - q - sigma * sigma * 0.5) * T / n        temp(1) = Exp(Z(i, 1))        For j = 2 To n            Z(i, j) = Z(i, j) * sigma * Sqr(T / n) + Z(i, j - 1) + (rr - q - sigma * sigma * 0.5) * T / n            temp(j) = Exp(Z(i, j))        Next j        payoff(i) = WorksheetFunction.Max(WorksheetFunction.Max(temp()) - temp(n), 0)    Next i    repeat(g) = WorksheetFunction.Average(payoff()) * Exp(-rr * T)Next g'For i = 1 To sim'Cells(i, 10) = Z(i, 1)'Cells(i, 11) = Z(i, 2)'Cells(i, 12) = Z(i, 3)'Cells(i, 21) = payoff(i)'Next iDim mean, Sdmean = WorksheetFunction.Average(repeat)Sd = WorksheetFunction.StDev(repeat)Cells(3, 7) = "Mean"Cells(3, 8) = meanCells(4, 7) = "SD"Cells(4, 8) = SdCells(5, 7) = "Upper Bound"Cells(5, 8) = mean + 2 * SdCells(6, 7) = "Lower Bound"Cells(6, 8) = mean - 2 * Sd    End Sub